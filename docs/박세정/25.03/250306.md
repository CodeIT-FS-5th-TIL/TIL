
# ğŸ“š ì£¼ì œ: useQueryë€ ë¬´ì—‡ì¸ê°€


ë‚ ì§œ: 2025-03-06



ì—Šê·¸ì œ React Queryì˜ ê°œë…ì„ ì •ë¦¬í•˜ë©°, useQueryì— ëŒ€í•´ ë” ê¹Šì´ ì´í•´í•  í•„ìš”ì„±ì„ ëŠê¼ˆìŠµë‹ˆë‹¤. ë˜í•œ, useQuery ì‚¬ìš©ë²•ì— ëŒ€í•´ ì•„ì§ ê°ì„ ì¡ì§€ ëª»í•´ì„œ ì•ìœ¼ë¡œì˜ ê°œë°œì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê¸° ìœ„í•´ useQueryë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ê³µë¶€í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ useQueryì˜ ê¸°ë³¸ ì‚¬ìš©ë²•ê³¼ ì£¼ìš” ê°œë…ì„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.


# ğŸ’¡useQuery


`useQuery`ëŠ” `React Query` ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” í›…ìœ¼ë¡œ, ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ (GET) ìºì‹±í•˜ë©°, ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. (ë°ì´í„° ì¡°íšŒê°€ ì•„ë‹Œ ë³€ê²½ì‘ì—…í•  ë•ŒëŠ” useMutation ì‚¬ìš©)


## ì£¼ìš” ê°œë…


`useQuery`ë¥¼ ì½”ë“œë¡œ ì‘ì„±í•˜ì—¬ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” `queryKey`, `queryFn` 2ê°€ì§€ ê°œë…ì„ í•„ìˆ˜ë¡œ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.


### queryKey(ì¿¼ë¦¬ í‚¤)

	- ë°°ì—´ í˜•íƒœë¡œ ì§€ì •í•˜ë©°, ì¿¼ë¦¬ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ í‚¤
	- ë™ì¼í•œ `queryKey`ë¥¼ ê°€ì§€ëŠ” ë‹¤ë¥¸ `useQuery`ê°€ ìˆì„ ê²½ìš°, ìºì‹±ëœ ë°ì´í„°ë¥¼ ì¬ì‚¬ìš©
	- queryKeyëŠ” ë°°ì—´ì´ë¯€ë¡œ ì—¬ëŸ¬ ê°œì˜ í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. ì´ë¥¼ ì´ìš©í•´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë§ˆë‹¤ í˜¹ì€ ê²€ìƒ‰ ê²°ê³¼ë§ˆë‹¤ ë‹¤ë¥¸ ìºì‹œë¥¼ ì‚¬ìš© ê°€ëŠ¥

		```javascript
		// ë‹¨ìˆœí•œ queryKey ì‚¬ìš© (ë°°ì—´ í˜•íƒœ)
		const { data } = useQuery({
		  queryKey: ['users'],  // 'users' ë°ì´í„°ì™€ ê´€ë ¨ëœ ìš”ì²­
		  queryFn: fetchUsers,
		});
		// => queryKeyëŠ” ['users']ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, React QueryëŠ” 'users' ë°ì´í„°ê°€ ì´ë¯¸ ìºì‹±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„, ìˆë‹¤ë©´ ìºì‹œëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
		
		// queryKeyì— ì—¬ëŸ¬ ê°œì˜ í‚¤ ì‚¬ìš© (ë™ì  ë°ì´í„°)
		const { data } = useQuery({
		  queryKey: ['user', userId],  // userIdì— ë”°ë¼ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ìš”ì²­
		  queryFn: () => fetchUser(userId),
		});
		// => queryKeyëŠ” ['user', userId]ì…ë‹ˆë‹¤. userId ê°’ì´ ë°”ë€Œë©´ React QueryëŠ” ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ìë™ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
		```


### queryFn(ì¿¼ë¦¬ í•¨ìˆ˜)

	- ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
	- `Promise`ë¥¼ ë°˜í™˜í•´ì•¼ í•˜ë©°, `async` í•¨ìˆ˜ë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŒ

	```javascript
	// queryFn ì‚¬ìš© ì˜ˆì‹œ
	const fetchUsers = async () => {
	  const response = await axios.get('/api/users');
	  return response.data;
	};
	
	const { data } = useQuery({
	  queryKey: ['users'],
	  queryFn: fetchUsers,
	});
	```


### ìƒíƒœ ê°’

	- `useQuery`ê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ì—ëŠ” ë‹¤ì–‘í•œ ìƒíƒœ ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŒ

		| **ìƒíƒœê°’**      | **ì„¤ëª…**                                   |
		| ------------ | ---------------------------------------- |
		| `isLoading`  | ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ë©´ true                       |
		| `isFetching` | ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‹¤ì‹œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì¸ì§€ ì—¬ë¶€              |
		| `isError`    | ì—ëŸ¬ ë°œìƒ ì—¬ë¶€(true/false)                     |
		| `isSuccess`  | ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì„±ê³µ ìƒíƒœ                           |
		| `error`      | ì—ëŸ¬ ë°œìƒ ì‹œ ì—ëŸ¬ ê°ì²´                            |
		| `data`       | ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¨ ë°ì´í„°                            |
		| `status`     | í˜„ì¬ ì¿¼ë¦¬ ìƒíƒœ ('loading', 'error', 'success') |


```javascript
// ì£¼ìš” ê°œë… ì‚¬ìš© ì˜ˆì‹œ
import { useQuery } from '@tanstack/react-query'

 function News() {
 const { data, isPending, isError } = useQuery(queryKey: ['news'], queryFn: fetchNews)
 if (isPending) return <div>Loading...</div>
 if (isError) return <div>Error...</div>
 return (
 <div>
      {data.map((news) => (
 <div key={news.id}>{news.title}</div>
      ))}
 </div>
  )
 }
```


### ì£¼ìš” ì˜µì…˜


	ì•„ë˜ì— ì íŒ ê²ƒ ì™¸ì—ë„ ë” ë§ì€ ì˜µì…˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤. [(Tanstack Query ê³µì‹ ì‚¬ì´íŠ¸ ì°¸ê³ )](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery)

<details>
<summary>`staleTime` (ë¹„í™œì„±í™”ëœ ë°ì´í„° ìœ ì§€ ì‹œê°„)</summary>
- ë°ì´í„°ë¥¼ ì‹ ì„ í•œ ìƒíƒœë¡œ ìœ ì§€í•  ì‹œê°„(ms) ì§€ì •
- ê¸°ë³¸ê°’ì€ 0ì´ë©°, 0ì¼ ë•ŒëŠ” ì¦‰ì‹œ ìƒˆë¡œìš´ ìš”ì²­ì„ ë³´ëƒ„

```javascript
// staleTime ì‚¬ìš© ì˜ˆì‹œ
useQuery({
  queryKey: ['posts'],
  queryFn: fetchPosts,
  staleTime: 1000 * 60 * 5, // 5ë¶„ ë™ì•ˆ ë°ì´í„°ë¥¼ ì‹ ì„ í•˜ê²Œ ìœ ì§€
});
```


</details>

<details>
<summary>`cacheTime` (ìºì‹œ ìœ ì§€ ì‹œê°„)</summary>
- ë°ì´í„°ë¥¼ ì‹ ì„ í•œ ìƒíƒœë¡œ ìœ ì§€í•  ì‹œê°„(ms) ì§€ì •
- ê¸°ë³¸ê°’ì€ 0ì´ë©°, 0ì¼ ë•ŒëŠ” ì¦‰ì‹œ ìƒˆë¡œìš´ ìš”ì²­ì„ ë³´ëƒ„

```javascript
// cacheTime ì‚¬ìš© ì˜ˆì‹œ
useQuery({
  queryKey: ['posts'],
  queryFn: fetchPosts,
  cacheTime: 1000 * 60 * 10, // 10ë¶„ ë™ì•ˆ ìºì‹œ ìœ ì§€
});
```


</details>

<details>
<summary>`refetchOnMount`</summary>
- ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ë‹¤ì‹œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ì§€ ì—¬ë¶€ë¥¼ ê²°ì •(ê¸°ë³¸ê°’ true)

```javascript
// refetchOnMount ì‚¬ìš© ì˜ˆì‹œ
useQuery({
  queryKey: ['posts'],
  queryFn: fetchPosts,
  refetchOnMount: false, // ìºì‹œëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìƒˆ ìš”ì²­ X
});
```


</details>

<details>
<summary>`refetchOnWindowFocus`</summary>
- ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì € íƒ­ì„ ë‹¤ì‹œ í™œì„±í™”í•  ë•Œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ì§€ ì—¬ë¶€ë¥¼ ê²°ì •(ê¸°ë³¸ê°’ true)

```javascript
// refetchOnWindowFocus ì‚¬ìš© ì˜ˆì‹œ
useQuery({
  queryKey: ['posts'],
  queryFn: fetchPosts,
  refetchOnWindowFocus: false, // íƒ­ì„ ì´ë™í•´ë„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ì§€ ì•ŠìŒ
});
```


</details>

<details>
<summary>`enabled`</summary>
- íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œë§Œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •
- `false`ë¡œ ì„¤ì •í•˜ë©´ ìë™ ì‹¤í–‰ì„ ë§‰ê³ , ì´í›„ `refetch`ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ

```javascript
// enabled ì‚¬ìš© ì˜ˆì‹œ
const { data, refetch } = useQuery({
  queryKey: ['user', userId],
  queryFn: fetchUser,
  enabled: !!userId, // userIdê°€ ìˆì„ ë•Œë§Œ ì‹¤í–‰
});
```


</details>


## useQueryì™€ useMutationì˜ ì°¨ì´


| **êµ¬ë¶„** | **useQuery**     | **useMutation**                         |
| ------ | ---------------- | --------------------------------------- |
| ì—­í•      | ë°ì´í„° ì¡°íšŒ (GET)     | ë°ì´í„° ì¶”ê°€. ìˆ˜ì •, ì‚­ì œ
(POST, PUT, DELETE ë“±)    |
| ì‹¤í–‰ ì‹œì   | ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ìë™ ì‹¤í–‰ | mutate í•¨ìˆ˜ í˜¸ì¶œ ì‹œì—ë§Œ ì‹¤í–‰,
ìˆ˜ë™ ì‹¤í–‰ (ë²„íŠ¼ í´ë¦­ ë“±)    |
| ìºì‹±     | ìë™ ìºì‹± ì§€ì›         | ìºì‹±í•˜ì§€ ì•ŠìŒ (ë³´í†µ ìˆ˜ë™ìœ¼ë¡œ invailidateQueries ì‚¬ìš©) |
| ì£¼ìš” ì˜ˆì‹œ  | `GET /posts`     | `POST /posts`, `PUT /posts/:id`         |


# ğŸ“ˆ ë‹¤ìŒ í•™ìŠµ ê³„íš(TIL ì£¼ì œ)

- [x] useQuery ì‚¬ìš©ë²• ìì„¸í•˜ê²Œ!
- [ ] Auth ê°œë…ê³¼ ì‚¬ìš©ë²•
- [ ] cors ì •ì±…

# ğŸ”— ì°¸ê³  ìë£Œ

- [useQurey ê³µì‹ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery)
