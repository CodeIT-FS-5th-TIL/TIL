"use strict";(self.webpackChunkcode_it_fs_5th_til=self.webpackChunkcode_it_fs_5th_til||[]).push([[86],{2486:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"\ubbfc\uc9c0\uc601/25.02/250227","title":"250227","description":"axios \uc640 Next \uc571 \ub77c\uc6b0\ud130 \uadf8\ub9ac\uace0 \ub9ac\uc561\ud2b8 \ucffc\ub9ac!","source":"@site/docs/\ubbfc\uc9c0\uc601/25.02/250227.mdx","sourceDirName":"\ubbfc\uc9c0\uc601/25.02","slug":"/\ubbfc\uc9c0\uc601/25.02/250227","permalink":"/TIL/docs/\ubbfc\uc9c0\uc601/25.02/250227","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\ubbfc\uc9c0\uc601/25.02/250227.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"TILSidebar","previous":{"title":"250225","permalink":"/TIL/docs/\ubbfc\uc9c0\uc601/25.02/250225"},"next":{"title":"250304","permalink":"/TIL/docs/\ubbfc\uc9c0\uc601/25.03/250304"}}');var i=t(4848),s=t(8453);const a={},o=void 0,c={},l=[{value:"axios \uc640 Next \uc571 \ub77c\uc6b0\ud130 \uadf8\ub9ac\uace0 \ub9ac\uc561\ud2b8 \ucffc\ub9ac!",id:"axios-\uc640-next-\uc571-\ub77c\uc6b0\ud130-\uadf8\ub9ac\uace0-\ub9ac\uc561\ud2b8-\ucffc\ub9ac",level:2},{value:"\ub9ac\uc561\ud2b8 \ucffc\ub9ac\ub294 \ub125\uc2a4\ud2b8 \uce90\uc2f1\uc774\ub791 \uae30\ub2a5\uc774 \ube44\uc2b7\ud55c\ub300\uc694?",id:"\ub9ac\uc561\ud2b8-\ucffc\ub9ac\ub294-\ub125\uc2a4\ud2b8-\uce90\uc2f1\uc774\ub791-\uae30\ub2a5\uc774-\ube44\uc2b7\ud55c\ub300\uc694",level:3},{value:"\ubb34\ud55c \uc2a4\ud06c\ub864",id:"\ubb34\ud55c-\uc2a4\ud06c\ub864",level:3},{value:"Next\uc758 revalidateTag\uc640 React-Query\uc758 invalidateQueries",id:"next\uc758-revalidatetag\uc640-react-query\uc758-invalidatequeries",level:3},{value:"\uc11c\ubc84 \ucef4\ud3ec\ub10c\ud2b8\uc758 \ub9ac\uc561\ud2b8 \ucffc\ub9ac",id:"\uc11c\ubc84-\ucef4\ud3ec\ub10c\ud2b8\uc758-\ub9ac\uc561\ud2b8-\ucffc\ub9ac",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"axios-\uc640-next-\uc571-\ub77c\uc6b0\ud130-\uadf8\ub9ac\uace0-\ub9ac\uc561\ud2b8-\ucffc\ub9ac",children:"axios \uc640 Next \uc571 \ub77c\uc6b0\ud130 \uadf8\ub9ac\uace0 \ub9ac\uc561\ud2b8 \ucffc\ub9ac!"}),"\n",(0,i.jsx)(n.h3,{id:"\ub9ac\uc561\ud2b8-\ucffc\ub9ac\ub294-\ub125\uc2a4\ud2b8-\uce90\uc2f1\uc774\ub791-\uae30\ub2a5\uc774-\ube44\uc2b7\ud55c\ub300\uc694",children:"\ub9ac\uc561\ud2b8 \ucffc\ub9ac\ub294 \ub125\uc2a4\ud2b8 \uce90\uc2f1\uc774\ub791 \uae30\ub2a5\uc774 \ube44\uc2b7\ud55c\ub300\uc694?"}),"\n",(0,i.jsx)(n.p,{children:'\uac70\uc758 \ube44\uc2b7\ud558\uc9c0\ub9cc \uc4f8\ub9cc\ud55c \uac74 \uc544\uc9c1 \uc788\uc2b5\ub2c8\ub2e4.\n\uc608\ub97c \ub4e4\uc5b4, "\ubb34\ud55c \uc2a4\ud06c\ub864"\uc774\ub77c\ub358\uac00 \uc544\ub2c8\uba74 "ui \uc989\uc2dc \ubc18\uc601"\uac19\uc740 \uae30\ub2a5\uc744 \uad6c\ud604\ud558\uae30\uc5d0\ub294 \ub9ac\uc561\ud2b8 \ucffc\ub9ac\uac00 \ub354 \uc720\ub9ac\ud569\ub2c8\ub2e4.'}),"\n",(0,i.jsx)(n.p,{children:"\uc77c\ub2e8 \uc774\ubc88\uc5d0 \uc18c\uac1c\ud560 \uac74 \ubb34\ud55c \uc2a4\ud06c\ub864 \uad6c\ud604\uc785\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.h3,{id:"\ubb34\ud55c-\uc2a4\ud06c\ub864",children:"\ubb34\ud55c \uc2a4\ud06c\ub864"}),"\n",(0,i.jsx)(n.p,{children:"\uc77c\ub2e8 API \uc11c\ube44\uc2a4\uc758 fetchData\ub97c \ub9ac\uc561\ud2b8 \ucffc\ub9ac\uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \uc218\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'"use server"; // revalidateTag \uc0ac\uc6a9\uc744 \uc704\ud574 \ud544\uc694\n\nimport type { Query } from "@/types";\nimport { apiLocal as api } from "./axios";\nimport { revalidateTag } from "next/cache";\n\ntype EndPoint = `/${string}`;\ntype FetchOptions =\n  | { cache: "no-store" | "no-cache" | "force-cache" }\n  | { next: { revalidate?: number; tags?: string[] } };\n\n// \uc870\ud68c \uc694\uccad \ud568\uc218\nexport const fetchData = async <T>(\n  endPoint: EndPoint,\n  fetchOptions?: FetchOptions,\n  params?: Query\n): Promise<T> => {\n  try {\n    const response = await api.get(endPoint, {\n      adapter: "fetch",\n      fetchOptions,\n      params,\n    });\n    const result: T = response.data;\n    return result;\n  } catch (error) {\n    console.error(error);\n    throw error;\n  }\n};\n'})}),"\n",(0,i.jsx)(n.p,{children:"\uadf8 \ub2e4\uc74c\uc5d0\ub294 \ubb34\ud55c \uc2a4\ud06c\ub864\uc744 \uad6c\ud604\ud560 \ud074\ub77c\uc774\uc5b8\ud2b8 \ucef4\ud3ec\ub10c\ud2b8 \ucf54\ub4dc\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'"use client";\n\nimport Button from "@/components/button/ButtonRectangle";\nimport Link from "next/link";\nimport Filter from "@/components/shared/Filter";\nimport Search from "@/components/shared/Search";\nimport type { Article, Query } from "@/types";\nimport ArticleItem from "./ArticleItem";\nimport { fetchData } from "@/lib/apis/service.ts";\nimport { useMemo, useRef, useState, useEffect } from "react";\nimport EmptyArticle from "@/components/empty/EmptyArticle";\nimport { useInfiniteQuery } from "@tanstack/react-query";\nimport SkeletonArticleItem from "@/components/skeleton/skeleton-article-item";\n\ninterface FetchCursorData {\n  articleList: Article[]; // \uac8c\uc2dc\uae00 \ubaa9\ub85d\n  hasNextPage: boolean; // \ub2e4\uc74c \ud398\uc774\uc9c0 \uc874\uc7ac \uc5ec\ubd80\n  nextCursor: string | undefined; // \ub2e4\uc74c \ud398\uc774\uc9c0 \ucee4\uc11c\n}\n\nconst LIMIT_COUNT = 8; // \ud55c \ubc88\uc5d0 \uac00\uc838\uc62c \uac8c\uc2dc\uae00 \uc218\n\nexport default function ArticleList() {\n  const sentinelRef = useRef<HTMLDivElement | null>(null); // IntersectionObserver \uac10\uc9c0 \uc694\uc18c\n  const observerRef = useRef<IntersectionObserver | null>(null); // IntersectionObserver\n  const [query, setQuery] = useState<Query>({\n    limit: LIMIT_COUNT,\n    keyword: "",\n    sortBy: "latest",\n    cursorId: undefined,\n  });\n\n  const {\n    data,\n    error,\n    fetchNextPage,\n    hasNextPage,\n    isPending,\n    isError,\n    isFetching,\n    isFetchingNextPage,\n  } = useInfiniteQuery<FetchCursorData>({\n    queryKey: ["articles", query.keyword, query.sortBy],\n    queryFn: ({ pageParam }) =>\n      fetchData<FetchCursorData>("/article", undefined, {\n        limit: LIMIT_COUNT,\n        keyword: query.keyword,\n        sortBy: query.sortBy,\n        cursorId: pageParam as string | undefined,\n      }),\n    initialPageParam: query.cursorId,\n    getNextPageParam: (lastPage) =>\n      lastPage.hasNextPage ? lastPage.nextCursor : undefined,\n  });\n\n  const articleList = useMemo(\n    () => data?.pages.flatMap((page) => page.articleList) ?? [],\n    [data]\n  );\n\n  useEffect(() => {\n    if (!sentinelRef.current || !hasNextPage) return; // sentinelRef\uac00 \uc5c6\uac70\ub098 \ub2e4\uc74c \ud398\uc774\uc9c0\uac00 \uc5c6\ub294 \uacbd\uc6b0\n\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) {\n          fetchNextPage();\n        }\n      },\n      { rootMargin: "200px", threshold: 1.0 } // \uc2a4\ud06c\ub864\uc774 sentinelRef\ubcf4\ub2e4 100px \uc704\uc5d0\uc11c \uac10\uc9c0\ub428\n    );\n\n    observerRef.current.observe(sentinelRef.current);\n\n    return () => {\n      observerRef.current?.disconnect();\n    };\n  }, [hasNextPage, fetchNextPage]);\n\n  return (\n    <>\n      <section className="flex items-center justify-between mb-4 md:mb-6">\n        <h1 className="text-gray-800 font-bold text-xl">\uac8c\uc2dc\uae00</h1>\n        <Link href="/article/create">\n          <Button isActive={true}>\uae00\uc4f0\uae30</Button>\n        </Link>\n      </section>\n\n      <section className="flex gap-4 mb-4 md:mb-6">\n        <Search\n          onSearch={(keyword) =>\n            setQuery((prev) => ({ ...prev, keyword, cursorId: undefined }))\n          }\n        />\n        <Filter\n          sortBy={query.sortBy}\n          onSort={(sortBy) =>\n            setQuery((prev) => ({ ...prev, sortBy, cursorId: undefined }))\n          }\n        />\n      </section>\n\n      {/* \ud398\uce58 \uc5d0\ub7ec\uc77c \uacbd\uc6b0 */}\n      {isError && <p>Error: {error?.message}</p>}\n\n      {/* \uac80\uc0c9 \uacb0\uacfc \ub610\ub294 \uac8c\uc2dc\uae00\uc774 \uc5c6\ub294 \uacbd\uc6b0 */}\n      {!isPending && articleList.length < 1 && (\n        <div className="flex flex-row mx-auto my-20">\n          <EmptyArticle keyword={query.keyword} />\n        </div>\n      )}\n\n      {/* \ub85c\ub529 \uc911\uc778 \uacbd\uc6b0 */}\n      {isPending && articleList.length < 1 && (\n        <section className="flex flex-col gap-6">\n          {Array.from({ length: LIMIT_COUNT }, (_, index) => (\n            <SkeletonArticleItem key={`article-${index}`} />\n          ))}\n        </section>\n      )}\n\n      {/* \uac8c\uc2dc\uae00 \ubaa9\ub85d */}\n      {!isPending && (\n        <section className="flex flex-col gap-6">\n          {articleList.map((article) => (\n            <Link href={`/article/${article.id}`} key={`article-${article.id}`}>\n              <ArticleItem article={article} />\n            </Link>\n          ))}\n        </section>\n      )}\n\n      {/* IntersectionObserver \uac10\uc9c0 \uc694\uc18c */}\n      <div ref={sentinelRef} className="h-10"></div>\n\n      {/* \ub354 \uc774\uc0c1 \ud398\uce6d\ub420 \ub370\uc774\ud130\uac00 \uc5c6\uc744 \ub54c \ud45c\uc2dc */}\n      {!isFetchingNextPage && !hasNextPage && (\n        <div className="text-center text-gray-500 mt-4">\n          \ub354 \uc774\uc0c1 \uac8c\uc2dc\uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.\n        </div>\n      )}\n\n      <div>{isFetching && !isFetchingNextPage ? "Fetching..." : null}</div>\n    </>\n  );\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"IntersectionObserver\ub97c \uc0ac\uc6a9\ud558\uc5ec sentinelRef\uac00 \ubcf4\uc774\uba74 \uc790\ub3d9\uc73c\ub85c \ub2e4\uc74c \ud398\uce6d\uc774 \uc774\ub8e8\uc5b4\uc9c0\uac8c \ub41c\ub2e4."}),"\n",(0,i.jsx)(n.h3,{id:"next\uc758-revalidatetag\uc640-react-query\uc758-invalidatequeries",children:"Next\uc758 revalidateTag\uc640 React-Query\uc758 invalidateQueries"}),"\n",(0,i.jsx)(n.p,{children:"revalidateTag\ub294 Next.js\uc758 \uce90\uc2dc\ub41c \ub370\uc774\ud130\ub97c \ud2b9\uc815 \ud0dc\uadf8\ub85c \ubb34\ud6a8\ud654(invalidate)\ud558\uace0, \ud574\ub2f9 \ud0dc\uadf8\uc640 \uc5f0\uacb0\ub41c \ub370\uc774\ud130\ub97c \ub2e4\uc74c \uc694\uccad \uc2dc \uc0c8\ub85c\uace0\uce68(refetch)\ud558\ub3c4\ub85d \ud2b8\ub9ac\uac70\ud558\ub294 \ud568\uc218.\ninvalidateQueries\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8 \uce90\uc2dc\ub97c \ubb34\ud6a8\ud654\ud558\uace0 \uc989\uc2dc refetch\ub85c UI \uac31\uc2e0."}),"\n",(0,i.jsx)(n.p,{children:"\uacb0\uad6d \ub458\ub2e4 \uce90\uc2f1\uc744 \ubb34\ud6a8\ud654 \uc2dc\ud0a4\uace0 \uc0c8\ub85c refetch \uc2dc\ucf1c\uc90c~"}),"\n",(0,i.jsx)(n.h3,{id:"\uc11c\ubc84-\ucef4\ud3ec\ub10c\ud2b8\uc758-\ub9ac\uc561\ud2b8-\ucffc\ub9ac",children:"\uc11c\ubc84 \ucef4\ud3ec\ub10c\ud2b8\uc758 \ub9ac\uc561\ud2b8 \ucffc\ub9ac"}),"\n",(0,i.jsx)(n.p,{children:"\ub9ac\uc561\ud2b8 \ucffc\ub9ac \uacf5\uc2dd\ubb38\uc11c\uc5d0\uc11c\ub294 \uc11c\ubc84 \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uc11c\ub294 \ud504\ub9ac\ud328\uce6d \uc774\uc678\uc5d0\ub294 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \uac83\uc744 \uad8c\uc7a5\ud558\uace0 \uc788\ub2e4."}),"\n",(0,i.jsx)(n.p,{children:"\uac1c\uc778\uc801\uc73c\ub85c \uc5b4\uca54 \uc218 \uc5c6\uc774 \ub9cc\ub4e4\uc5b4\uc9c4 \ud074\ub77c\uc774\uc5b8\ud2b8 \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uc11c \ud328\uce6d\uc774 \ud544\uc694\ud560 \ub54c \ub9ac\uc561\ud2b8 \ucffc\ub9ac\ub97c \uc0ac\uc6a9\ud558\uace0 \uc11c\ubc84 \ucef4\ud3ec\ub10c\ud2b8\uc5d0\uc11c\ub294 \ud544\uc694\uc5c6\ub294 \uac83 \uac19\ub2e4!"}),"\n",(0,i.jsx)(n.p,{children:"\ub125\uc2a4\ud2b8 \uce90\uc2f1\uc774 \ub300\ubd80\ubd84 \ub9ac\uc561\ud2b8 \ucffc\ub9ac\uc640 \uae30\ub2a5\uc774 \ube44\uc2b7\ud558\uace0, \ub2e4\ub978 \uc810\uc774\ub77c\uba74 \uc704 \ub9d0\ud588\ub4ef\uc774 \ubb34\ud55c\uc2a4\ud06c\ub864\uc774\ub77c\ub358\uac00.. ui\uc989\uc2dc \uc5c5\ub370\uc774\ud2b8 \ub77c\ub358\uac00 \uae30\ub2a5\uc774 \uc544\ub2cc \uc774\uc0c1 \ub125\uc2a4\ud2b8 \uce90\uc2f1\uc73c\ub85c \ubaa8\ub450 \uac00\ub11d!"})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);